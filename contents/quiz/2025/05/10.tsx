import { Quiz, generateQuizId, generateFilePath } from "@/contents/quiz";

export default function QuizContent() {
  const quiz = new Quiz({
    // ----- metadata -----
    id: generateQuizId(import.meta.url),
    file_path: generateFilePath(import.meta.url),
    author: "jimatomo",
    author_url: "https://github.com/jimatomo",
    tags: ["Data Management", "Security"],
    created_at: new Date("2025-05-10"),
    updated_at: new Date("2025-05-10"),

    // ----- quiz -----
    title: "永続的データマスキングの方法論",
    question_jsx: <QuizQuestion />,
    options: {
      0: "インプレース永続マスキング: 開発環境およびテスト環境でのみ利用可能な手法であり、本番環境のデータを直接変更することはありません。元の機密データは完全にマスキング後のデータに置き換えられます。",
      1: "インフライト永続マスキング: 本番データベースから開発・テスト環境へデータを抽出・転送する際にマスキング処理を行い、転送先の環境にはマスキングされたデータのみが格納される。",
      2: "ダイナミックデータマスキング: ユーザーの役割や権限に応じて、クエリ実行時にリアルタイムでデータをマスキングする。元のデータ自体は変更されないため、本番環境のデータを保護しつつ、権限のあるユーザーは元のデータにアクセスできる。",
    },
    answers: [0],
    explanation_jsx: <QuizExplanation />,
    references: [
      { title: "データマネジメント知識体系ガイド 第二版", url: "https://www.amazon.co.jp/%E3%83%87%E3%83%BC%E3%82%BF%E3%83%9E%E3%83%8D%E3%82%B8%E3%83%A1%E3%83%B3%E3%83%88%E7%9F%A5%E8%AD%98%E4%BD%93%E7%B3%BB%E3%82%AC%E3%82%A4%E3%83%89-%E7%AC%AC%E4%BA%8C%E7%89%88-DAMA-International/dp/4296100491" },
      { title: "ダイナミックデータマスキングについて - Snowflake Documentation", url: "https://docs.snowflake.com/ja/user-guide/security-column-ddm-intro" },
    ],
  });
  return quiz;
}

function QuizQuestion() {
  return (
    <div>
      <span>
        データマスキングの方法論に関する記述として、<span className="text-red-500">間違っている</span>ものを選択してください。
      </span>
    </div>
  );
}

function QuizExplanation() {
  return (
    <div className="text-xs md:text-sm">
      <p className="py-2">
        <strong>「インプレース永続マスキング: 開発環境およびテスト環境でのみ利用可能な手法であり、本番環境のデータを直接変更することはありません。元の機密データは完全にマスキング後のデータに置き換えられます。」</strong>という記述は間違っています。
        インプレース永続マスキングは、ソースデータベース（元データがある場所）とターゲットデータベース（マスキング後のデータを置く場所）が同じである場合に適用される手法です。つまり、元のデータベース内のデータを直接マスキング処理し、その結果で元のデータを上書きします。
        この手法は、必ずしも開発環境やテスト環境専用というわけではありません。例えば、何らかの理由でセンシティブデータが存在してはならない本番環境（例：分析用途のデータベースだが、コンプライアンス上マスキングが必須な場合など）で、既存データをマスキングするために利用されることがあります。
        ただし、インプレースマスキングは元のデータを直接変更するため、マスキング処理中に何らかの問題が発生した場合、元の状態に復元することが非常に困難であるという大きなリスクを伴います。そのため、この手法の採用は慎重に検討される必要があり、他の安全なマスキング手法（例：インフライトマスキング）が適用可能な場合はそちらが優先されることが多く、一般的に頻繁に用いられる手法ではありません。
      </p>
      <p className="py-2">
        その他の選択肢は正しい記述です：
      </p>
      <ul className="list-disc pl-4">
        <li className="pb-2">
          <strong>インフライト永続マスキング: 本番データベースから開発・テスト環境へデータを抽出・転送する際にマスキング処理を行い、転送先の環境にはマスキングされたデータのみが格納される。</strong>
          これは正しい記述です。インフライトマスキング（またはETLマスキングとも呼ばれる）は、データがソースからターゲットへ移動する過程でマスキング処理を適用し、ターゲット環境にはマスキング済みのデータのみが保存されるようにします。元の本番データは変更されません。
        </li>
        <li className="pb-2">
          <strong>ダイナミックデータマスキング: ユーザーの役割や権限に応じて、クエリ実行時にリアルタイムでデータをマスキングする。元のデータ自体は変更されないため、本番環境のデータを保護しつつ、権限のあるユーザーは元のデータにアクセスできる。</strong>
          これも正しい記述です。ダイナミックデータマスキングは、データそのものには手を加えず、参照時にポリシーに基づいてマスキングを行うため、セキュリティと利便性のバランスを取ることができます。永続的なマスキングとは異なり、元のデータはそのまま保持されます。
        </li>
      </ul>
      <p className="pt-2">
        データマスキング手法を選択する際は、それぞれの特性、メリット、デメリット（特にリスク）を十分に理解し、組織の要件や環境に合わせて最適なものを選択することが極めて重要です。
      </p>
    </div>
  );
} 
